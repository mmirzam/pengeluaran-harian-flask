<!-- RINGKASAN PENGELUARAN -->
<div class="card p-3 shadow-sm mb-4 bg-light">
    <h5 class="card-title fs-5 mb-3 text-center">Ringkasan Pengeluaran</h5>
    <div class="row text-center g-2">
        <div class="col-6">
            <p class="mb-0 text-muted small">Total Hari Ini</p>
            <h4 class="text-danger">Rp {{ "{:,.0f}".format(total_harian) }}</h4>
        </div>
        <div class="col-6 border-start">
            <p class="mb-0 text-muted small">Total Bulan Ini</p>
            <h4 class="text-danger">Rp {{ "{:,.0f}".format(total_bulanan) }}</h4>
        </div>
    </div>
</div>

<!-- FORM INPUT PENGELUARAN -->
<div class="card p-3 shadow-sm">
    <h5 class="card-title fs-5 mb-3">Input Pengeluaran Baru</h5>
    <form method="POST" action="{{ url_for('tambah') }}">
        <input type="hidden" name="jenis" value="pengeluaran">
        <div class="row g-3">
            <div class="col-12">
                <label for="nominal_formatted" class="form-label">Nominal (Rp)</label>
                <input type="text" class="form-control form-control-lg nominal-input" id="nominal_formatted"
                       oninput="formatNominal(this)" placeholder="Pengeluaran (1k - 200k)..." required>
                <input type="hidden" name="nominal" id="nominal_clean"
                       min="{{ batas_nominal_min }}" max="{{ batas_nominal_max }}">
            </div>

            <div class="col-12">
                <label class="form-label d-block">Metode Pembayaran</label>
                <div class="btn-group w-100" role="group">
                    <input type="radio" class="btn-check" name="metode" id="metodeQris" value="qris" checked>
                    <label class="btn btn-outline-danger" for="metodeQris">MBANKING</label>

                    <input type="radio" class="btn-check" name="metode" id="metodeCash" value="cash">
                    <label class="btn btn-outline-danger" for="metodeCash">Cash</label>
                </div>
            </div>

            <div class="col-sm-6 col-12">
                <label for="tanggal" class="form-label">Tanggal</label>
                <input type="date" class="form-control" id="tanggal" name="tanggal"
                       value="{{ current_date }}" min="{{ batas_tanggal_min }}" max="{{ batas_tanggal_max }}" required>
            </div>

            <div class="col-sm-6 col-12">
                <label for="catatan" class="form-label">Catatan (Opsional)</label>
                <input type="text" class="form-control" id="catatan" name="catatan"
                       placeholder="Makan siang, bensin, dll.">
            </div>
        </div>
        <button type="submit" class="btn btn-danger mt-4 w-100 btn-lg">‚úÖ SIMPAN PENGELUARAN</button>
    </form>
</div>

<!-- CHART & LOG -->
<div class="mt-5 text-center">
    <button class="btn btn-info w-100" type="button" data-bs-toggle="collapse"
            data-bs-target="#chartCollapse_exp">üìä Tampilkan Analisis & Log Data Pengeluaran</button>
</div>

<div class="collapse mt-4" id="chartCollapse_exp">
    <div class="card p-3 shadow-sm">
        <ul class="nav nav-tabs">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#mingguan-exp">Mingguan</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#bulanan-exp">Bulanan</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#log-exp">Log Akhir</button></li>
        </ul>

        <div class="tab-content p-2">
            <div class="tab-pane fade show active" id="mingguan-exp"><canvas id="weeklyChartExp"></canvas></div>
            <div class="tab-pane fade" id="bulanan-exp"><canvas id="monthlyChartExp"></canvas></div>
            <div class="tab-pane fade" id="log-exp">
                <h6 class="mt-3">10 Pengeluaran Terakhir</h6>
                <div class="table-responsive">
                    <table class="table table-sm table-striped">
                        <thead>
                        <tr>
                            <th>Tgl</th>
                            <th>Metode</th>
                            <th>Nominal</th>
                            <th>Catatan</th>
                            <th>Aksi</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for pengeluaran in pengeluaran_list %}
                            <tr>
                                <td>{{ pengeluaran.Tanggal | default('') }}</td>
                                <td>{{ pengeluaran.Metode.upper() }}</td>
                                <td>Rp {{ "{:,.0f}".format(pengeluaran.Nominal) }}</td>
                                <td>{{ pengeluaran.Catatan }}</td>
                                <td>
                                    <form method="POST" action="/delete"
                                          onsubmit="return confirm('Yakin ingin menghapus pengeluaran ini?')">
                                        <input type="hidden" name="row_index" value="{{ pengeluaran.row_index }}">
                                        <input type="hidden" name="tab_type" value="pengeluaran">
                                        <button type="submit" class="btn btn-danger btn-sm p-1">üóëÔ∏è</button>
                                    </form>
                                </td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
